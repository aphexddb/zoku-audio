"use strict";angular.module("twitterMoodApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.router"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.when("","/").rule(function(a,b){var c=b.path();"/"!==c&&"/"===c.slice(-1)&&b.replace().path(c.slice(0,-1))}),a.state("home",{url:"/",templateUrl:"views/tweets.html",controller:"TweetsCtrl"})}]).run(["$rootScope","$state","$stateParams",function(a,b,c){a.$state=b,a.$stateParams=c}]).controller("BodyController",["$scope","$rootScope",function(a,b){a.foo=b.foo="bar"}]),angular.module("twitterMoodApp").factory("TweetService",["$rootScope","$timeout",function(a,b){var c="ws://localhost:8081/ws/tweets",d=null,e=null,f=null,g=!1,h={},i=5e3,j={0:"websocket connection is not yet open",1:"websocket connection is open and ready to communicate",2:"websocket connection is in the process of closing",3:"websocket connection is closed or couldn't be opened"},k=function(){l()},l=function(){d=new WebSocket(c),d.onopen=function(){var a=event.currentTarget.readyState;console.log("Tweets -",j[a]),f(!0),g=!0},d.onclose=function(){console.log("Twitter Mood: websocket connection closed, will attempt to reconnect in",i/1e3,"seconds"),b(k,i),f(!1),g=!1},d.onmessage=function(a){e(JSON.parse(a.data))}};return h.setOnlineCallback=function(a){f=a},h.setCallback=function(a){e=a,l()},h.send=function(a){g?d.send(JSON.stringify(a)):console.log("Twitter Mood: unable to change terms, offline")},h}]).controller("TweetsCtrl",["$scope","TweetService",function(a,b){a.terms="edm,drop,noise,bass",a.smooth=!0,a.score=.5,a.tweets=[],a.online=!1;var c=10,d=[],e=0,f=function(a,b){void 0===typeof b&&(b=a,a=0);for(var c=[],d=b>a?1:-1,e=0;e<=Math.abs(b-a);e++)c.push(a+e*d);return c};d=f(0,360);var g=function(){e=d[Math.floor(Math.random()*d.length)]};g();var h=function(a){var b=a+180;return b>360&&(b-=360),b};b.setOnlineCallback(function(b){a.$apply(function(){a.online=b})}),b.setCallback(function(b){a.$apply(function(){b.primaryColor=e,b.secondaryColor=h(e),a.online=!0;var d=null;null!==b.geo&&(d={latitude:b.geo.coordinates[0],longitude:b.geo.coordinates[1]}),a.tweets.push(b),a.tweets.length>c&&a.tweets.shift(),a.score=a.smooth?parseFloat(b.avgScore).toFixed(3):parseFloat(b.rawScore).toFixed(3)})});var i=function(a){var b=[];return void 0!==a&&a.split(",").forEach(function(a){b.push(a.trim())}),b};a.changeTerms=function(){g();var c=i(a.terms);b.send({terms:c})}}]);